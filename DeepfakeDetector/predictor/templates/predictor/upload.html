{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Deepfake Detection Platform</title>
  <!-- Change 1: Use the Django static tag to load the CSS -->
  <link rel="stylesheet" href="{% static 'predictor/style.css' %}" />
</head>
<body>
  <div class="overlay">
    <div class="container">
      <header>
        <h1>üéØ Deepfake Detection Platform</h1>
        <p>Secure, AI-powered analysis for audio, image, and video files</p>
      </header>

      <section class="intro">
        <h2>üîç Check Any File Instantly</h2>
        <p>Upload your media below and detect synthetic manipulations using advanced backend verification.</p>
      </section>

      <form id="uploadForm" enctype="multipart/form-data">
        <!-- Django's CSRF token is required for security -->
        {% csrf_token %}
        <label for="fileInput">üìÅ Upload Media File:</label>
        <input type="file" id="fileInput" name="media" accept="audio/*,video/*,image/*" required />

        <div class="button-group">
          <button type="submit" class="btn large-btn">üöÄ Detect</button>
          <button type="button" class="btn large-btn" onclick="clearInputs()">üßπ Clear</button>
          <button type="button" class="btn large-btn" onclick="showInfo()">üìò Info</button>
        </div>
      </form>

      <div id="result"></div>

      <footer>
        &copy; 2025 Deepfake Safety Initiative | Created by Code10thrive
      </footer>
    </div>
  </div>

  <script>
    function clearInputs() {
      document.getElementById('fileInput').value = '';
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = '';
      resultDiv.className = ''; // Clear result styling
    }

    function showInfo() {
      alert('This platform uses AI to detect deepfake content in audio, images, and video files with high precision.');
    }

    document.getElementById("uploadForm").addEventListener("submit", async function (e) {
      e.preventDefault();

      const resultDiv = document.getElementById('result');
      const fileInput = document.getElementById('fileInput');
      const submitButton = e.target.querySelector('button[type="submit"]');

      if (fileInput.files.length === 0) {
        resultDiv.innerHTML = '<p class="error">Please select a file to upload.</p>';
        return;
      }

      resultDiv.innerHTML = '<p class="loading">Analyzing... Please wait.</p>';
      submitButton.disabled = true;

      const formData = new FormData();
      formData.append("media", fileInput.files[0]);
      const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

      try {
        const response = await fetch("/detect", {
          method: "POST",
          headers: {
            'X-CSRFToken': csrfToken,
          },
          body: formData,
        });

        const result = await response.json();

        resultDiv.className = result.class;
        resultDiv.innerHTML = `
          <h4>${result.text}</h4>
          ${result.confidence ? `<p class="confidence">Confidence: <strong>${result.confidence}</strong></p>` : ''}
        `;

      } catch (error) {
        resultDiv.className = 'error';
        resultDiv.innerHTML = '<h4>An error occurred.</h4><p>Could not connect to the server.</p>';
        console.error("Fetch error:", error);
      } finally {
        submitButton.disabled = false;
      }
    });
  </script>
</body>
</html>
